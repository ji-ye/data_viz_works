---
title: "Theme & Design"
author: "Ji, Ye"
date: "10/20/2017"
output:
  html_document:
    code_folding: hide
    fig_width: 9
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=TRUE, include=FALSE}
# install packages
install.packages("easypackages", repos = "http://cran.us.r-project.org")
library(easypackages)
packages("anytime","tidyverse","rmarkdown","readr", "haven", "dplyr", "stringr", "ggplot2", "xts", "igraph", "countrycode", "extrafont", "waffle",
         "rworldmap", "maps")

# set master theme
theme_jiye <- theme(panel.grid.major.y =element_line( size=.1, color="#999999"),
                    panel.grid.major.x = element_blank(),
                    panel.background = element_blank(),
                    plot.title = element_text(size=24,
                                              family = "Helvetica",
                                              colour = "#3a3a3a",
                                              face = "bold"),
                    plot.subtitle = element_text(size=12,
                                                 family = "Avenir",
                                                 colour = "#666666"),
                    axis.title.y = element_text(colour="#325a8c"),
                    axis.title.x = element_blank(),
                    axis.text.y = element_text(colour="#325a8c"),
#                    axis.text.x = element_blank(),
                    axis.ticks.y = element_blank(),
#                    axis.ticks.x = element_blank(),
                    legend.position = "none",
                    plot.caption = element_text(size=8,
                                                family = "Avenir",
                                                colour = "#666666",
                                                hjust = 0
                                                ),
                    plot.margin = unit(c(0,0,0,0), "cm"))

# Load data
#   graph one data
btc_price = read_csv("./data/BCHAIN-MKPRU.csv") # as of 10-21
btc_price <- mutate(btc_price, Date = as.POSIXct(Date))

#   graph 2-1 data
nodes = read_csv("./data/20171021_nodes.csv")
nodes <- mutate(nodes, country = countrycode(country_code,
                                             origin="iso2c",
                                             destination = "country.name.en"))

# graph 2-2 data
# I have a full nodes dataset pulled from BitNodes, but for this graph
# data has to be hand-typed here thanks to waffle package requirement.
# It's great.
nation_list <- c(`U.S.A (962)`=2962,
                `Germany (1716)`=1716,
                `France (665)`=665,
                `Netherlands (519)`=519,
                `China (511)`=511,
                `Canada (431)`=431,
                `U.K & Northern Ireland (362)`=362,
                `Russian Federation (334)`=334,
                `Singapore (217)`=217,
                `Ireland (201)`=201,
                `Australia (149)`=149,
                `Japan (138)`=138,
                `Switzerland (138)`=138,
                `Sweden (131)`=131,
                `Hong Kong (102)`=102,
                `Rest of the World(1397)`=1397)

#   graph three data
# note: this graph should show correlation between price rise with buying interests.
# get trading volume by coin by left_join volume_usd with price
#volume_usd <- read_csv("./data/20171018_Bitcoin USD Exchange Trading Volume.csv")
#volume_usd <- mutate(volume_usd, Date = as.POSIXct(Date))
#volume_usd$unit <- "USD"

#volume_usd <- mutate(volume_coin, unit = "USD")

#agg <- left_join(x=volume_usd, y=btc_price, by="Date")
#colnames(agg) <- c("Date", "volume_usd", "price_usd")
#agg <- mutate(agg, volume_coin = volume_usd/price_usd)
# ISSUE: what is difference betwen <- and = ?
#colnames(volume_agg) <- c("Date", "volume_coin", "volume_usd")

#   graph four data
#   graph five data
#   graph six data
#   graph seven data
```

<br/>

### Introduction

There are several advantages to dedicate a data visualization portfolio and 10-week effort to digital currency:

* Massive and Robust data source: Blockchain is a public transaction log
  that exists as a distributed database, validated by its powerful algorithm.
    
* Fitting data types: Blockchain data includes time and IP addresses, and 
  can be updated frequently, which means it is useful for both the static and
  dynamic data visualizations.
    
* Well-supported: I can save the entire blockchain file locally,use 
  community-maintained tools to parse it, and keep the data up-to-date.
    
* Policy-setting: Digital currencies are being used as store of value to 
fight inflation in turbulent economies such as Zimbabwe and Latin American
countries. Central Banks are issuing experimental policies in response to 
the dessemination of digital currency and blockchain technology.
    
This paper will explore some data sources published by major Bitcoin exchanges and platforms as an market overview.


``` {r, dpi=300}
rectangle <- data.frame(xmin = as.POSIXct(c("2017-03-25")),
                        xmax = as.POSIXct(c("2017-10-21")),
                        ymin = -Inf,
                        ymax = Inf)

line <- ggplot(data=btc_price) +
  geom_line(size=.25,
            aes(Date, Value),
            color="#325a8c") +
  geom_vline(xintercept = as.POSIXct("2017-03-25"),
             colour="#ff7575",
             size=.5,
             linetype="dotted",
             alpha=.75) +
  scale_y_continuous(name ="Bitcoin Market Price in USD",
                     breaks = (seq(0,6000,1000))
                     ) +
  scale_x_datetime(date_breaks = "1 year",
                   labels = seq(2009,2018,1),
                   expand=c(0,0)) +
  ggtitle("Bitcoin Price",
          subtitle = "experienced the greatest surge in history this year") +
  labs(caption = "Source: Blockchain.com") +
  annotate(geom="text",
           x=as.POSIXct("2016-01-01"),
           y=2200,
           label="Surge started on Mar 25, 2017",
           colour="#ff7575",
           family="Avenir",
           fontface="bold",
           alpha=1) +
  theme_jiye

line + geom_rect(data = rectangle, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
                 fill = "#ff7575", alpha = 0.1)
```

<br/>

### Bitcoin price is volatile

The price of bitcoin can increase or decrease drastically over a
short period of time. This graph mainly serves as a priliminary 
evidence to pinpoint certain time points where a new policy or
event may have impacted the price of Bitcoin.

<br/>

```{r, dpi=300, fig.asp=.65}
# graph 2-1: nodes map
# map theme
theme_map <- theme(panel.grid.major.y = element_blank(),
                    panel.grid.major.x = element_blank(),
                    panel.background = element_blank(),
                    plot.title = element_text(size=24,
                                              family = "Helvetica",
                                              colour = "#3a3a3a",
                                              face = "bold"),
                    plot.subtitle = element_text(size=12,
                                                 family = "Avenir",
                                                 colour = "#666666"),
                    axis.title.y = element_blank(),
                    axis.title.x = element_blank(),
                    axis.text.y = element_blank(),
                    axis.text.x = element_blank(),
                    axis.ticks.y = element_blank(),
                                        axis.ticks.x = element_blank(),
                    legend.position = "none",
                    plot.caption = element_text(size=8,
                                                family = "Avenir",
                                                colour = "#666666",
                                                hjust = 0
                    ),
                    plot.margin = unit(c(0,0,0,0), "cm"))

# ISSUE: How to color code by country?
# ISSUE: How to remove Antarctica?
mp <- NULL
mapWorld <- borders("world", colour="#FFFFFF", fill='grey75', alpha=0.6,
                    ylim = c(-50, 70)) # create a layer of borders
mp <- ggplot() + mapWorld

#Now Layer the cities on top
mp <- mp+ geom_point(aes(x=nodes$longitude, y=nodes$latitude) ,color="#fe5346", size=0.75, alpha=.25) + 
  geom_path(aes(x=nodes$longitude, y=nodes$latitude), color="#FF9900", size=.1, alpha=0.025,
            linejoin = "bevel") +
  ggtitle("Global Nodes Distribution",
          subtitle = "is uneven across continents") +
  labs(caption = "Source: BitNodes") +
  theme_map
mp
```

```{r, dpi=300}
# graph 2-2: waffle chart
nation_cols <- c(
                "#93B7BE","#584F50","#b3906a","#FF991C",'#fb4d3d',
                '#ff9b9b','#313E50','#78323e','#20FC8F','#90E0F3',
                '#5b8e7d','#ffb7c5','#CFB53B','#769855','#e13224',
                "#CCCCCC"
                )

waffle <- waffle(nation_list%/%100,
       rows=3,
       size=1.5,
       colors=nation_cols,
       legend_pos = "bottom",
       xlab="Total nodes as of Oct 18, 2017 (10320)",
       title='Bitcoin Nodes Distribution by Countries (source: BitNodes)')
waffle
```

### (REWRITE THIS) Which countries are more crytocurrency-friendly?

Countries that have more reachable nodes means more people in
the countries are involved in maintaining the bitcoin network,
which indicates that these countries are more likely to have policies,
or the lack of, to support the development of cryptocurrency.
For an explorative analysis, this graph is helpful for narrowing
down the origin of some major policies that have shaped the 
development of Bitcoin. If we consider this graph as a ranking
of countries' involvement in digital currency. It is interesting
to note that, this ranking is not necessarily ordered in exact 
accordance with the ranking of GDP, population, technological
advancement, or even perceived internet presence.

<br/>


```{r, fig.width = 16, fig.height = 12}
# note: color #85bb65 is nicknamed as "dollar bill green".
#       color #FF9900 is the orange from bitcoin logo.
```