---
title: "Theme & Design"
author: "Ji, Ye"
date: "10/20/2017"
output:
  html_document:
    code_folding: hide
    fig_width: 9
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=TRUE, include=FALSE}
# install packages.
#install.packages("easypackages", repos = "http://cran.us.r-project.org")
library(easypackages)
packages("anytime","tidyverse","rmarkdown","readr", "haven", "dplyr", "stringr", "ggplot2", "xts", "igraph", "countrycode")

# set master theme
theme_jiye <- theme(panel.grid.major.y =element_line( size=.1, color="#999999"),
                    panel.grid.major.x = element_blank(),
                    panel.background = element_blank(),
                    plot.title = element_text(size=24,
                                              family = "Helvetica",
                                              colour = "#3a3a3a",
                                              face = "bold"),
                    plot.subtitle = element_text(size=12,
                                                 family = "Avenir",
                                                 colour = "#666666"),
                    axis.title.y = element_text(colour="#325a8c"),
                    axis.title.x = element_blank(),
                    axis.text.y = element_text(colour="#325a8c"),
#                    axis.text.x = element_blank(),
                    axis.ticks.y = element_blank(),
#                    axis.ticks.x = element_blank(),
                    legend.position = "none",
                    plot.caption = element_text(size=8,
                                                family = "Avenir",
                                                colour = "#666666",
                                                hjust = 0
                                                ),
                    plot.margin = unit(c(1,1,1,1), "cm"))

# Load data
#   graph one data
btc_price = read_csv("./data/BCHAIN-MKPRU.csv")
btc_price <- mutate(btc_price, Date = as.POSIXct(Date))

#   graph two data
nodes = read_csv("./data/20171021_nodes.csv")
nodes <- mutate(nodes, country = countrycode(country_code,
                                             origin="iso2c",
                                             destination = "country.name.en"))
country_list <- table(nodes$country)
country_list <- as.data.frame(country_list)
colnames(country_list) = c('country', 'node')

#   graph three data
# note: this graph should show correlation between price rise with buying interests.
# get trading volume by coin by left_join volume_usd with price
volume_usd <- read_csv("./data/20171018_Bitcoin USD Exchange Trading Volume.csv")
volume_usd <- mutate(volume_usd, Date = as.POSIXct(Date))
volume_usd$unit <- "USD"

#volume_usd <- mutate(volume_coin, unit = "USD")

agg <- left_join(x=volume_usd, y=btc_price, by="Date")
colnames(agg) <- c("Date", "volume_usd", "price_usd")
agg <- mutate(agg, volume_coin = volume_usd/price_usd)
# ISSUE: what is difference betwen <- and = ?
colnames(volume_agg) <- c("Date", "volume_coin", "volume_usd")

#   graph four data
#   graph five data
#   graph six data
#   graph seven data
```

### Introduction

There are several advantages to dedicate a data visualization portfolio and 10-week effort to digital currency:

* Massive and Robust data source: Blockchain is a public transaction log
  that exists as a distributed database, validated by its powerful algorithm.
    
* Fitting data types: Blockchain data includes time and IP addresses, and 
  can be updated frequently, which means it is useful for both the static and
  dynamic data visualizations.
    
* Well-supported: I can save the entire blockchain file locally,use 
  community-maintained tools to parse it, and keep the data up-to-date.
    
* Policy-setting: Digital currencies are being used as store of value to 
fight inflation in turbulent economies such as Zimbabwe and Latin American
countries. Central Banks are issuing experimental policies in response to 
the dessemination of digital currency and blockchain technology.
    
This paper will explore some data sources published by major Bitcoin exchanges and platforms as an market overview.

### Graph one

``` {r, dpi=300}
rectangle <- data.frame(xmin = as.POSIXct(c("2017-03-25")),
                        xmax = as.POSIXct(c("2017-10-21")),
                        ymin = -Inf,
                        ymax = Inf)

line <- ggplot(data=btc_price) +
  geom_line(size=.25,
            aes(Date, Value),
            color="#325a8c") +
  geom_vline(xintercept = as.POSIXct("2017-03-25"),
             colour="#ff7575",
             size=.5,
             linetype="dotted",
             alpha=.75) +
  scale_y_continuous(name ="Bitcoin Market Price in USD",
                     breaks = (seq(0,6000,1000))
                     ) +
  scale_x_datetime(date_breaks = "1 year",
                   labels = seq(2009,2018,1),
                   expand=c(0,0)) +
  ggtitle("Bitcoin Price",
          subtitle = "experienced the greatest surge in history this year") +
  labs(caption = "Source: Blockchain.com") +
  annotate(geom="text",
           x=as.POSIXct("2016-01-01"),
           y=2200,
           label="Surge started on Mar 25, 2017",
           colour="#ff7575",
           family="Avenir",
           fontface="bold",
           alpha=1) +
  theme_jiye

line + geom_rect(data = rectangle, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
                 fill = "#ff7575", alpha = 0.1)
```

<br/>

### Bitcoin price is volatile

The price of bitcoin can increase or decrease drastically over a
short period of time. This graph mainly serves as a priliminary 
evidence to pinpoint certain time points where a new policy or
event may have impacted the price of Bitcoin.

<br/>

### Graph two
```{r, dpi=300, fig.asp=2}
theme_graph2 <- theme(panel.grid.major.y = element_blank(),
                    panel.grid.major.x = element_blank(),
                    panel.background = element_blank(),
                    plot.title = element_text(size=18,
                                              family = "Helvetica",
                                              colour = "#3a3a3a",
                                              face = "bold"),
                    plot.subtitle = element_text(size=12,
                                                 family = "Avenir",
                                                 colour = "#666666"),
                    axis.title.y = element_text(colour="#325a8c"),
                    axis.title.x = element_blank(),
                    axis.text.y = element_text(colour="#325a8c"),
#                    axis.text.x = element_blank(),
                    axis.ticks.y = element_blank(),
#                    axis.ticks.x = element_blank(),
                    legend.position = "none",
                    plot.caption = element_text(size=8,
                                                family = "Avenir",
                                                colour = "#666666",
                                                hjust = 0
                                                ),
                    plot.margin = unit(c(1,1,1,1), "cm"))

hist <- ggplot(data=country_list, aes(reorder(factor(country), node), node)) +
  geom_col(width=0.9, position=position_dodge(width=5), fill = "#999999") +
  geom_text(aes(label=node),
            color="#666666",
            position=position_dodge(width=0.9),
            vjust=0.35,
            hjust=-.25
  ) +
  ggtitle("Bitcoin Nodes Distribution by Countries",
          subtitle = "Number of reachable nodes as of Oct 21, 2017") +
  ylab("") +
  xlab("") +
  labs(caption = "Source: BitNodes") +
  theme_graph2 +
  scale_x_discrete(expand=c(0,0)) +
  coord_flip()

hist
```

### (REWRITE THIS) Which countries are more crytocurrency-friendly?

Countries that have more reachable nodes means more people in
the countries are involved in maintaining the bitcoin network,
which indicates that these countries are more likely to have policies,
or the lack of, to support the development of cryptocurrency.
For an explorative analysis, this graph is helpful for narrowing
down the origin of some major policies that have shaped the 
development of Bitcoin. If we consider this graph as a ranking
of countries' involvement in digital currency. It is interesting
to note that, this ranking is not necessarily ordered in exact 
accordance with the ranking of GDP, population, technological
advancement, or even perceived internet presence.

<br/>

## Graph Three - stacked area

```{r, fig.width = 16, fig.height = 12}
# note: color #85bb65 is nicknamed as "dollar bill green".
#       color #FF9900 is the orange from bitcoin logo.
area <- ggplot(data=volume_agg, aes(x = as.POSIXct(Date), y = volume_usd, fill = as.factor(unit))) +
  geom_area(position = "stack") +
  scale_x_datetime(date_breaks = "3 months", expand=c(0,0)) +
  scale_y_continuous(breaks = c(0, 250, 500, 750, 1000, 2000, 3000)) + 
  scale_fill_manual(values = alpha(c("#FF9900", "#85bb65")), 0.2) +
  ggtitle("Bitcoin Daily Trading Volume",
          subtitle = "in number of bitcoin & Thousands of USD") +
  labs(caption = "Data source: Coinbase API",
       x = "",
       y = "Volume") +
  theme(panel.grid.major.y =element_line( size=.1, color="#999999"),
        panel.grid.major.x = element_blank(),
        panel.background = element_blank(),
        plot.title = element_text(size=18,
                                  family = "Helvetica",
                                  colour = "#3a3a3a",
                                  face = "bold"),
        plot.subtitle = element_text(size=12, family = "mono", colour = "#666666"),
        axis.text.y = element_text(color="#666666"),
        axis.title.y = element_text(color="#666666"),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_text(size=10, family = "mono", colour = "#666666"),
        legend.title = element_blank(),
        legend.position = c(0.05, 0.95),
        plot.caption = element_text(size=11, family = "mono", colour = "#666666"),
        plot.margin = unit(c(2,2,2,2), "cm"))

area
```